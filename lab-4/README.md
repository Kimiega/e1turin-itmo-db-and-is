# Лабораторная работа #4. Вариант 83476519

## Задание.

По варианту, выданному преподавателем, составить и выполнить запросы к базе
данных "Учебный процесс".

Команда для подключения к базе данных `ucheb`:

```bash
psql -h pg -d ucheb 
```

Отчёт по лабораторной работе должен содержать:

- Текст задания.
- Реализацию запросов на SQL.
- Планы выполнения запросов.
- Ответы на вопросы, представленные в задании.
- Выводы по работе.

Темы для подготовки к защите лабораторной работы:

- Индексы
- Оптимизация запросов
- Выбор плана выполнения запросов

Составить запросы на языке SQL (пункты 1-2).

Для каждого запроса предложить индексы, добавление которых уменьшит время
выполнения запроса (указать таблицы/атрибуты, для которых нужно добавить
индексы, написать тип индекса; объяснить, почему добавление индекса будет
полезным для данного запроса).

Для запросов 1-2 необходимо составить возможные планы выполнения запросов.
Планы составляются на основании предположения, что в таблицах отсутствуют
индексы. Из составленных планов необходимо выбрать оптимальный и объяснить свой
выбор. Изменятся ли планы при добавлении индекса и как?

Для запросов 1-2 необходимо добавить в отчет вывод команды 
`EXPLAIN ANALYZE [запрос]`

Подробные ответы на все вышеперечисленные вопросы должны присутствовать в
отчете (планы выполнения запросов должны быть нарисованы, ответы на вопросы -
представлены в текстовом виде).

- Сделать запрос для получения атрибутов из указанных таблиц, применив фильтры
  по указанным условиям: 

  Таблицы: `Н_ЛЮДИ`, `Н_ВЕДОМОСТИ`. 

  Вывести атрибуты: `Н_ЛЮДИ.ИМЯ`, `Н_ВЕДОМОСТИ.ИД`. 

  Фильтры (`AND`):
    - `Н_ЛЮДИ.ФАМИЛИЯ < Афанасьев`.
    - `Н_ВЕДОМОСТИ.ИД > 39921`.
    - `Н_ВЕДОМОСТИ.ИД < 1250981`. 

  Вид соединения: `INNER JOIN`.

- Сделать запрос для получения атрибутов из указанных таблиц, применив фильтры
  по указанным условиям: 

  Таблицы: `Н_ЛЮДИ`, `Н_ВЕДОМОСТИ`, `Н_СЕССИЯ`. 

  Вывести атрибуты: `Н_ЛЮДИ.ФАМИЛИЯ`, `Н_ВЕДОМОСТИ.ЧЛВК_ИД`, `Н_СЕССИЯ.ДАТА`. 

  Фильтры (`AND`):
    - `Н_ЛЮДИ.ФАМИЛИЯ = Иванов`.
    - `Н_ВЕДОМОСТИ.ДАТА < 2022-06-08`. 

  Вид соединения: `RIGHT JOIN`.

- - -

# Комментарии

## Выполнение задания

Задания выполнялись совместно с @Malevrovich: (1) — он, (2) — я.

Ужасная инфологическая модель базы лежит в docs: БД [Учебный Процесс.png](../docs/DB-study-process.png).

Планы составления запросов представлены в docs:

- [req-1_plan-1.png](../docs/req-1_plan-1.png)
- [req-1_plan-2.png](../docs/req-1_plan-2.png)
- [req-1_plan-3.png](../docs/req-1_plan-3.png)
- [req-2_plan-1.png](../docs/req-2_plan-1.png)
- [req-2_plan-2.png](../docs/req-2_plan-2.png)

- короткий доклад про индексы: https://youtu.be/aaecM4wKdhY
- `SELECT amname FROM pg_am;` чтобы получить доступные виды индексов
- синтаксис создания индексов: https://www.postgresql.org/docs/current/sql-createindex.html

Какие индексы использовать:

- BRIN (https://postgrespro.ru/docs/postgresql/9.5/brin-intro)
- GIN для полнотекстового поиска (https://www.postgresql.org/docs/current/textsearch-indexes.html)
- Hash (?) или другая любая подходящая хеширующая функция

## Защита

- виды индексов
    - какой для чего
- кластерный индекс
- деревья планов запросов (левое дерево, куст)
    - материализация во время выполнения запроса
    - конвейерная обработка
- concurrent создание индекса
- способы сканирования таблицы
    - bitmap scan
- ...
