# Лабораторная работа № 2 Вариант НФБК

## Задание
**Лабораторная работа №4**

Для отношений, полученных при построении предметной области из
лабораторной работы №1, выполните следующие действия:

- опишите функциональные зависимости для отношений полученной схемы (минимальное множество);
- приведите отношения в 3NF (как минимум). Постройте схему на основе полученных отношений;
- опишите изменения в функциональных зависимостях, произошедшие после преобразования в 3NF;
- преобразуйте отношения в BCNF. Докажите, что полученные отношения представлены в BCNF;
- какие денормализации будут полезны для вашей схемы? Приведите подробное описание;

## Выполнение задания

### Функциональные зависимости

В таблице `biology_entity`:

- `id` $\to$ `name`
- `id` $\to$ `location_id`
- `id` $\to$ `live_epoch_id`
- `id` $\to$ `biology_hierarchy_id`
- `biology_hierarchy_id` $\to$ `live_epoch_id`

В таблице `character`:

- `id` $\to$ `location_id`

В таблице `character_join_biology_entity`:

- `id` $\to$ (`character_id`, `biology_entity_id`)
- `id` $\to$ `detail`
- (`character_id`, `biology_entity_id`) $\to$ `detail`

В таблице `live_epoch`:

- `id` $\to$ `description`
- `id` $\to$ `time_interval`

В таблице `biology_hierarchy`:

- `id` $\to$ `name`
- `id` $\to$ `characteristics`

В таблице `location`:

- `id` $\to$ `name`

В таблице `protection_method`:

- PK $\to$ `name`
- PK $\to$ `description`


### Приведение в 3NF 

#### 1NF 

_Условие_: 

> Переменная отношения находится в первой нормальной форме (1НФ) тогда и только
тогда, когда в любом допустимом значении отношения каждый его кортеж содержит
только одно значение для каждого из атрибутов. 

_Вывод_:

Представленные таблицы находятся в 1NF, т.к. все значения всех атрибутов всех
сущностей, имеют не более одного значения, если смотреть на пересечение строк и
столбцов. За исключением `live_epoch (time_interval)` и `biology_hierarchy (characteristics)`, 
где присутствуют слабо структурированные данные (в формате `json`).

Слабо структурированные атрибуты сущностей в формате `jsonb`, на мой взгляд не
должны выделяться в отдельные атрибуты по той причине, что данные которые должны
храниться в этих атрибутах в самом деле слабоструктурированные. Не для каждой
сущности можно определить (по крайней мере сразу) в каком месте иерархии живых
существ наше существо находится и в какой эпохе оно существовало, ведь в Парке
Юрского периода были чудовища, про которых трудно что-либо сказать. 


#### 2NF

_Условие_:

> Переменная отношения находится во второй нормальной форме тогда и только
тогда, 
> - когда она находится в первой нормальной форме 
> - и каждый неключевой атрибут неприводимо (функционально полно) зависит от её
потенциального ключа.
>
> Функционально полная зависимость означает, что если потенциальный ключ
является составным, то атрибут зависит от всего ключа и не зависит от его
частей. 

_Вывод_:

Переменные отношения находятся в 1НФ. 

Лишь в таблице `character_join_biology_entity` существует неполная
функциональная зависимость от потенциального ключа (`character_id`,
`biology_entity_id`), но в данном случае произошла ошибка при проектировании
базы данных: атрибут `id` можно удалить из этого отношения. 

В остальном каждый неключевой атрибут функционально полно
зависит от её потенциального ключа.

#### 3NF

_Условие_:

Переменная отношения находится в третьей нормальной форме тогда и только тогда,
- когда она находится во второй нормальной форме, 
- и отсутствуют транзитивные функциональные зависимости неключевых атрибутов от
ключевых. 

_Вывод_:

Для избавления от транзитивных зависимостей (`character`: `id` $\to$
`biology_hierarchy_id`, `biology_hierarchy_id` $\to$ `live_epoch_id`) необходимо
выделить из отношения `character` атрибуты `biology_hierarchy_id` и
`live_epoch_id` в отдельное отношение (подробнее в [BCNF](#bcnf)).


#### BCNF

_Условие_:

> Переменная отношения находится в нормальной форме Бойса — Кодда (иначе — в
усиленной третьей нормальной форме) тогда и только тогда, когда каждая её
нетривиальная и неприводимая слева функциональная зависимость имеет в качестве
своего детерминанта некоторый потенциальный ключ.

_Вывод_:

Лишь `hierarchy` и `live_epoch` из отношения `biology_entity` можно выделить в
отдельное отношение с первым атрибутом в качестве потенциального ключа, чтобы
существовала необходимая функциональная зависимость. 

Остальные же зависимости в качестве детерминанта имеет потенциальный ключ.

#### Денормализация

Денормализация для текущей конфигурации схемы данных не требуется, но для БКНФ
она бы потребовалась, чтобы внести выделенную зависимость в отношение
`biology_hierarchy`. Это избавляет от дополнительного соединения через отдельнуюпри 
сущность при комплексном запросе. При этом целостность не должна нарушиться,
т.к. в тех атрибутах основную информацию несут слабо структурированные данные,
которые предполагаются к свободному изменению. Так же можно было бы объединить
некоторые характеристические сущности для большей простоты добавления данных.

## Вывод

Во время выполнения ЛР ознакомились с 1НФ, 2НФ, 3НФ, НФБК. Проанализировали
связи между сущностями выделенными в ЛР №1, что позволило проверить
эффективность разработанной схемы данных.

